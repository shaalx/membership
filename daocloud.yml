image: daocloud/ci-golang:1.4

services:
    - mongodb

env:
    - GOPATH /gpath

install:
    - echo "This is an install segment"
    - sudo apt-get -y install curl
    - sudo apt-get -y install bzr

before_script:
    - export GOPATH=/gpath
    - export PATH=$GOPATH/bin:$PATH
    - mkdir -p $GOPATH/src $GOPATH/bin $GOPATH/pkg
    # - git clone --recursive git://github.com/shaalx/membership.git $GOPATH/src/github.com/shaalx/membership
    # - git clone https://github.com/shaalx/membership $GOPATH/src/github.com/shaalx/membership
    - go get -u github.com/shaalx/membership
    # - cd $GOPATH/src/github.com/shaalx/membership; git checkout mem;ls ; go install
    - cd $GOPATH/src/github.com/shaalx/membership;ls ; go build -o membership;sudo chmod +x membership ;cp membership $GOPATH/bin/
    - cd $GOPATH/bin; ls
script:
    - echo "This is an script segment"
    - ping -c 2 mongodb
    - $GOPATH/bin/membership &
    - sleep 4
    - curl http://localhost/
    - curl http://localhost/db